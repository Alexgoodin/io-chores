<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IO Chores</title>
  <meta name="description" content="Simple household chore tracker with a lightweight password gate." />
  <style>
    :root{
      --bg:#0f172a; --text:#e5e7eb; --muted:#9ca3af; --brand:#60a5fa; --ok:#34d399; --bad:#f87171; --warn:#fbbf24; --radius:18px; --shadow:0 10px 25px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; color:var(--text);
      background: radial-gradient(1200px 600px at 20% -10%, #1e293b 0%, #0b1022 45%, #090d1c 60%, #060913 100%), #0f172a;}
    a{color:var(--brand); text-decoration:none}
    .container{max-width:1100px; margin:0 auto; padding:20px}
    .row{display:flex; gap:14px; align-items:center; flex-wrap:wrap}
    .title{font-weight:800; letter-spacing:.3px; font-size:22px}
    .spacer{flex:1}
    .subtle{color:var(--muted); font-size:14px}
    .btn{appearance:none; border:1px solid rgba(255,255,255,.12); background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.08));
      color:var(--text); border-radius:12px; padding:9px 14px; cursor:pointer; transition:.18s transform ease, .18s opacity;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06), 0 1px 0 rgba(255,255,255,.05);}
    .btn:hover{transform:translateY(-1px)}
    .btn.ghost{background:transparent}
    .btn.primary{border-color: rgba(96,165,250,.5); background: linear-gradient(180deg, rgba(96,165,250,.25), rgba(96,165,250,.1));}
    .btn.danger{border-color: rgba(248,113,113,.5); background: linear-gradient(180deg, rgba(248,113,113,.25), rgba(248,113,113,.1));}

    main{padding:24px 20px 60px}
    .grid{max-width:1100px; margin:0 auto; display:grid; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); gap:18px}
    .card{background: linear-gradient(160deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08); border-radius: var(--radius);
      box-shadow: var(--shadow); padding:16px 16px 14px}
    .name{font-size:18px; font-weight:700}
    ul.chores{margin:8px 0 12px 0; padding-left:18px; color:var(--muted)}
    ul.chores li{margin:4px 0}
    .report{display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap}
    .pill{font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.1); background: rgba(255,255,255,.04)}
    .pill.yes{border-color: rgba(52,211,153,.6); background: rgba(52,211,153,.08)}
    .pill.no{border-color: rgba(248,113,113,.6); background: rgba(248,113,113,.08)}
    .pill.pending{border-color: rgba(251,191,36,.6); background: rgba(251,191,36,.08)}
    .actions{display:flex; gap:8px}

    /* Overlays */
    .overlay{position:fixed; inset:0; display:flex; align-items:center; justify-content:center; padding:18px; z-index:9999;
      background: radial-gradient(1200px 600px at 20% -10%, rgba(30,41,59,.8) 0%, rgba(9,13,28,.9) 60%, rgba(6,9,19,.95) 100%);
      border-top:1px solid rgba(255,255,255,.06);
    }
    .modal{width:100%; max-width:520px; background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.1); border-radius:22px; box-shadow: var(--shadow); padding:22px}
    .modal h1{margin:4px 0 2px; font-size:28px}
    .muted{color:var(--muted)}
    .field{margin-top:14px; display:flex; gap:8px}
    input[type=password], input[type=text]{flex:1; background: rgba(255,255,255,.06); color:var(--text); border:1px solid rgba(255,255,255,.12);
      border-radius:12px; padding:10px 12px; font-size:16px; outline:none}
    .error{color:#fecaca; font-size:13px; min-height:16px; margin-top:4px}

    footer.note{max-width:1100px; margin:16px auto 32px; padding:0 20px; color:var(--muted); font-size:12px}
    [hidden]{display:none !important}
  </style>
</head>
<body>
  <!-- Password Gate -->
  <div id="auth-overlay" class="overlay">
    <div class="modal" autocomplete="off">
      <h1>IO Chores</h1>
      <p class="muted">Enter the password to continue.</p>
      <div class="field">
        <input id="password" type="password" placeholder="Password" aria-label="Password" />
        <button id="login-button" class="btn primary" type="button" onclick="login()">Enter</button>
      </div>
      <div id="pw-error" class="error"></div>
      <p class="subtle" style="margin-top:10px">Heads up: this is a lightweight client-side lock for convenience, not true security.</p>
    </div>
  </div>

  <!-- App Header -->
  <header hidden id="app-header">
    <div class="container">
      <div class="row">
        <div class="title">IO Chores</div>
        <div class="subtle">Today: <span id="today"></span></div>
        <div class="spacer"></div>
        <span id="admin-badge" class="pill" hidden>ADMIN</span>
        <div class="subtle" id="summary">0/0 reported today</div>
        <button id="export" class="btn ghost" hidden onclick="doExport()">Export</button>
        <button id="import" class="btn ghost" hidden onclick="document.getElementById('import-file').click()">Import</button>
        <button id="reset-today" class="btn danger" hidden onclick="resetToday()">Reset Today</button>
        <button id="signout" class="btn ghost" onclick="signOut()">Sign out</button>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main id="app" hidden>
    <div class="container">
      <section id="admin-panel" hidden>
        <h2>People & Chores (Admin)</h2>
        <div id="admin-rows"></div>
        <div class="row" style="margin:10px 0">
          <button class="btn" onclick="addAdminRow()">+ Add Person</button>
          <div class="spacer"></div>
          <button class="btn primary" onclick="saveAdmin()">Save Changes</button>
        </div>
        <hr style="border-color:rgba(255,255,255,.1)"/>
      </section>
      <div class="grid" id="grid"></div>
    </div>
  </main>

  <footer class="note">
    Tip: All data stays on this device (localStorage). Use Export/Import to move it.
  </footer>

  <!-- Hidden file input for import -->
  <input type="file" id="import-file" accept="application/json" hidden />

  <script>
  // ===== Simple, robust vanilla JS (no frameworks, no modals on load) =====
  const USER_PASSWORD = 'BOOCH';
  const ADMIN_PASSWORD = 'GOODINISTHEBEST';
  const STORAGE_KEY = 'iochores_data_v2';

  let role = null; // 'user' | 'admin'
  let data = loadData();

  function loadData(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(raw) return JSON.parse(raw);
    }catch(e){}
    return {members:[
      {id:'alex', name:'Alex', chores:['Dishes','Trash']},
      {id:'sam', name:'Sam', chores:['Laundry','Vacuum']},
      {id:'taylor', name:'Taylor', chores:['Wipe counters','Feed pets']}
    ], reports:{}};
  }
  function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }
  function today(){ return new Date().toISOString().slice(0,10); }
  function ensureToday(){ const k=today(); if(!data.reports[k]){ data.reports[k]={}; save(); } }
  function slug(s){ return (s||'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'') || 'm-'+Math.random().toString(36).slice(2,7); }
  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }

  function login(){
    const v = (document.getElementById('password').value||'').trim();
    if(!v) return;
    if(v === USER_PASSWORD){
      role = 'user';
      startApp();
    } else if(v === ADMIN_PASSWORD){
      role = 'admin';
      startApp(true);
    } else {
      document.getElementById('pw-error').textContent = 'Incorrect password.';
    }
  }
  document.getElementById('password').addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); login(); }});

  function startApp(openAdmin=false){
    document.getElementById('auth-overlay').hidden = true;
    document.getElementById('app').hidden = false;
    document.getElementById('app-header').hidden = false;
    document.getElementById('today').textContent = new Date().toLocaleDateString();

    const isAdmin = role === 'admin';
    document.getElementById('admin-badge').hidden = !isAdmin;
    document.getElementById('export').hidden = !isAdmin;
    document.getElementById('import').hidden = !isAdmin;
    document.getElementById('reset-today').hidden = !isAdmin;
    document.getElementById('admin-panel').hidden = !isAdmin;

    render();
    if(openAdmin && isAdmin){ renderAdmin(); }
  }

  function render(){
    ensureToday();
    const k = today();
    const grid = document.getElementById('grid');
    grid.innerHTML = '';
    let reportedCount = 0, total = data.members.length;

    data.members.forEach(m => {
      const status = data.reports[k][m.id];
      if(status && typeof status.reported==='boolean') reportedCount++;
      const div = document.createElement('div');
      div.className = 'card';
      div.innerHTML = `
        <div class="name">${escapeHtml(m.name)}</div>
        <ul class="chores">${m.chores.map(c=>`<li>${escapeHtml(c)}</li>`).join('')}</ul>
        <div class="report">
          <span>Status: ${status ? (status.reported ? '<span class="pill yes">Reported: YES</span>' : '<span class="pill no">Reported: NO</span>') : '<span class="pill pending">No report</span>'}</span>
          <div class="actions">
            <button class="btn primary" onclick="reportYes('${m.id}')">Yes</button>
            <button class="btn" onclick="reportNo('${m.id}')">No</button>
            <button class="btn ghost" onclick="reportClear('${m.id}')">Clear</button>
          </div>
        </div>`;
      grid.appendChild(div);
    });
    document.getElementById('summary').textContent = `${reportedCount}/${total} reported today`;
  }

  function reportYes(id){ ensureToday(); data.reports[today()][id]={reported:true, ts:Date.now()}; save(); render(); }
  function reportNo(id){ ensureToday(); data.reports[today()][id]={reported:false, ts:Date.now()}; save(); render(); }
  function reportClear(id){ ensureToday(); delete data.reports[today()][id]; save(); render(); }
  function resetToday(){ if(role!=='admin') return; if(confirm('Clear everyoneâ€™s report for today?')){ data.reports[today()]={}; save(); render(); } }

  // ---- Admin panel ----
  function renderAdmin(){
    const box = document.getElementById('admin-rows');
    box.innerHTML = '';
    data.members.forEach(m=>{
      const row = document.createElement('div');
      row.className = 'row';
      row.innerHTML = `
        <input class="m-name" placeholder="Name" value="${escapeHtml(m.name)}" />
        <input class="m-chores" placeholder="Chores (comma-separated)" value="${escapeHtml(m.chores.join(', '))}" />
        <button class="btn" onclick="this.parentElement.remove()">Remove</button>`;
      box.appendChild(row);
    });
  }
  function addAdminRow(){
    const box = document.getElementById('admin-rows');
    const row = document.createElement('div');
    row.className = 'row';
    row.innerHTML = `
      <input class="m-name" placeholder="Name" />
      <input class="m-chores" placeholder="Chores (comma-separated)" />
      <button class="btn" onclick="this.parentElement.remove()">Remove</button>`;
    box.appendChild(row);
  }
  function saveAdmin(){
    if(role !== 'admin') return;
    const rows = Array.from(document.querySelectorAll('#admin-rows .row'));
    const members = rows.map(r=>{
      const name = r.querySelector('.m-name').value.trim();
      const chores = r.querySelector('.m-chores').value.split(',').map(s=>s.trim()).filter(Boolean);
      if(!name) return null;
      return {id: slug(name), name, chores};
    }).filter(Boolean);
    data.members = dedupe(members);
    save();
    render();
    alert('Saved!');
  }
  function dedupe(arr){ const seen = new Set(); return arr.filter(m=> (seen.has(m.id) ? false : (seen.add(m.id), true))); }

  // ---- Export / Import ----
  function doExport(){ if(role!=='admin') return; const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='io-chores-data.json'; a.click(); URL.revokeObjectURL(url); }
  document.getElementById('import-file').addEventListener('change', e=>{
    if(role!=='admin') return;
    const f=e.target.files[0]; if(!f) return;
    const reader=new FileReader();
    reader.onload=()=>{ try{ const obj=JSON.parse(reader.result); if(obj && Array.isArray(obj.members) && obj.reports && typeof obj.reports==='object'){ data=obj; save(); render(); renderAdmin(); alert('Imported!'); } else alert('Invalid file.'); }catch(err){ alert('Parse error'); } };
    reader.readAsText(f); e.target.value='';
  });

  function signOut(){ role=null; location.reload(); }

  // Do not auto-login; always show the password screen at start
  document.getElementById('auth-overlay').hidden = false;
  </script>
</body>
</html>
